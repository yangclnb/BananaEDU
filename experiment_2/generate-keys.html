<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <title>ç”Ÿæˆç§˜é’¥</title>
    <link rel="stylesheet" href="./styles/main.css" />
  </head>

  <body>
    <nav>
      <a class="selected" href="./generate-keys.html">ç”Ÿæˆç§˜é’¥</a>
      <a href="./encrypt-text.html">åŠ å¯†ä¿¡æ¯</a>
      <a href="./decrypt-text.html">è§£å¯†ä¿¡æ¯</a>
      <!-- <a href="encrypt-file.html">Encrypt File</a>
            <a href="decrypt-file.html">Decrypt File</a> -->
    </nav>

    <div class="page">
      <h1>ç”Ÿæˆä½ çš„ RSA éå¯¹ç§°åŠ å¯†ç§˜é’¥ ğŸ˜</h1>
      <p class="header-description">
        æƒ³è¦ä½“éªŒç¥å¥‡çš„éå¯¹ç§°åŠ å¯†ï¼Œæ²¡æœ‰ç§˜é’¥å¯ä¸è¡Œï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç”Ÿæˆå¯†é’¥
      </p>

      <button id="button">ç‚¹å‡»ç”Ÿæˆç§˜é’¥</button>
      <div id="message"></div>

      <div id="result">
        <div class="field">
          <label for="public-key"
            >è¿™æ˜¯ä½ çš„å…¬é’¥ | å…¬é’¥å¯ä»¥é€éœ²ç»™æƒ³è¦ç»™ä½ å‘é€åŠ å¯†ä¿¡æ¯çš„äºº</label
          >
          <a id="public-key-download" class="download" download="id_rsa.pub"
            >ä¸‹è½½ä½ çš„å…¬é’¥ id_rsa.pub</a
          >
          <textarea id="public-key-text" rows="10" readonly></textarea>
        </div>

        <div class="field">
          <label for="private-key"
            >è¿™æ˜¯ä½ çš„ç§é’¥ | ç§é’¥åªèƒ½è‡ªå·±æŒæœ‰ï¼Œä¸è¦æ³„éœ²å“¦</label
          >
          <a id="private-key-download" class="download" download="id_rsa"
            >ä¸‹è½½ä½ çš„ç§é’¥ id_rsa</a
          >
          <textarea id="private-key-text" rows="10" readonly></textarea>
        </div>
      </div>
    </div>

    <footer>
      <p>ä½›å†ˆå¿ä¿¡æ¯ç§‘æŠ€æ•™è‚²å¹³å°|ä½œè€…ï¼šæ¨æ™¨é¾™</p>
    </footer>
  </body>

  <script src="./scripts/encoding-helper.js"></script>
  <script src="./scripts/encryption-helper.js"></script>
  <script>
    (function () {
      var publicKeyText = document.getElementById("public-key-text");
      var publicKeyDownload = document.getElementById("public-key-download");
      var privateKeyText = document.getElementById("private-key-text");
      var privateKeyDownload = document.getElementById("private-key-download");
      var button = document.getElementById("button");
      var message = document.getElementById("message");
      var result = document.getElementById("result");

      var success = function (keys) {
        publicKeyText.value = arrayBufferToPem(
          keys.publicKeyBuffer,
          "RSA PUBLIC KEY"
        );
        publicKeyDownload.href = window.URL.createObjectURL(
          new Blob([publicKeyText.value], { type: "application/octet-stream" })
        );
        privateKeyText.value = arrayBufferToPem(
          keys.privateKeyBuffer,
          "RSA PRIVATE KEY"
        );
        privateKeyDownload.href = window.URL.createObjectURL(
          new Blob([privateKeyText.value], { type: "application/octet-stream" })
        );
        result.style.display = "block";
        message.innerText = null;
        button.disabled = false;
      };

      var error = function (error) {
        message.innerText = error;
        button.disabled = false;
      };

      var process = function () {
        message.innerText = "æ­£åœ¨ç”Ÿæˆå¯†é’¥...";
        button.disabled = true;
        generateRsaKeys().then(success, error);
      };

      var warn = function () {
        if (privateKey.value === "") return;
        return "ä½ ç¡®å®šè¦åˆ é™¤å¯†é’¥å—ï¼Ÿé™¤éä½ å·²ç»ä¿å­˜äº†å¯†é’¥ï¼Œå¦åˆ™å®ƒä»¬ä¼šä¸¢å¤±çš„ã€‚";
      };

      button.addEventListener("click", process);
      window.onbeforeunload = warn;
    })();
  </script>
</html>
